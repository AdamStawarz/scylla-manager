version: '2.1'

services:
  manager:
    image: scylla-manager:${MANAGER_VERSION}
    volumes:
      - ./scylla_manager.pem:/var/lib/scylla-manager/scylla_manager.pem:ro
    ports:
      - "127.0.0.1:56443:56443"
    depends_on:
      scylla:
        condition: service_healthy

  scylla:
    image: scylladb/scylla:${SCYLLA_VERSION}
    volumes:
      - ./data:/var/lib/scylla/data:Z
      - ./commitlog:/var/lib/scylla/commitlog:Z
    healthcheck:
      test: "[ `nodetool statusgossip` = running ]"
      interval: 10s
      timeout: 5s
      retries: 4

