FROM centos:7 as base

# Install Scylla Manager.
ARG BRANCH
ADD http://downloads.scylladb.com.s3.amazonaws.com/manager/rpm/unstable/centos/${BRANCH}/latest/scylla-manager.repo /etc/yum.repos.d/
RUN yum -y install epel-release scylla-manager-server scylla-manager-client && \
    yum clean all && \
    rm -f /etc/yum.repos.d/scylla-manager.repo
COPY scylla-manager-docker.yaml /etc/scylla-manager/

EXPOSE 5080
EXPOSE 5443
EXPOSE 5090
EXPOSE 5112

USER scylla-manager
ENV HOME /var/lib/scylla-manager/

ENTRYPOINT ["/usr/bin/scylla-manager"]
CMD ["-c", "/etc/scylla-manager/scylla-manager.yaml", "-c", "/etc/scylla-manager/scylla-manager-docker.yaml"]
